# =============================================================================
# opensc.conf - Configuration OpenSC pour JavaCard virtuelle
# =============================================================================

app default {
    # Niveau de debug (0-9, 0=off, 9=max)
    debug = 3;
    debug_file = /app/logs/opensc-debug.log;
    
    # Profil de la carte
    profile_dir = /usr/share/opensc;
    
    # Configuration du lecteur PC/SC
    reader_driver pcsc {
        # Timeout de connexion (ms)
        connect_timeout = 10000;
        # Timeout de transaction (ms)  
        transaction_timeout = 30000;
        # Activer la reconnexion automatique
        enable_reconnect = true;
        # Mode d'accès exclusif
        enable_exclusive = true;
    }
    
    # Configuration spécifique JavaCard
    card_driver javacard {
        # ATR pattern pour identifier la carte
        atr = 3B:8F:80:01:80:4F:0C:A0:00:00:00:03:06:03:00:01:00:00:00:00:6A;
        
        # Forcer ce driver pour cet ATR
        force_protocol = t1;
    }
    
    # Framework PKCS#15 pour la gestion des objets cryptographiques
    framework pkcs15 {
        # Utiliser le cache des certificats
        use_file_caching = true;
        
        # Répertoire de cache
        file_cache_dir = /tmp/opensc-cache;
        
        # PIN policies
        pin_policy {
            # Longueur minimale du PIN
            min_pin_length = 4;
            # Longueur maximale du PIN
            max_pin_length = 16;
        }
    }
}

# Configuration du module PKCS#11
app opensc-pkcs11 {
    # Hériter des paramètres par défaut
    # inherit = default;
    
    pkcs11 {
        # Nombre maximum de slots virtuels
        max_virtual_slots = 32;
        
        # Slots à afficher même sans carte
        slots_per_card = 2;
        
        # Verrouillage de session
        lock_login = true;
        
        # Cache du PIN en mémoire
        cache_pins = false;
        
        # Attributs des objets
        token_default_label = "JavaCard Virtual Token";
        token_default_manufacturer = "jCardSim Emulator";
    }
}

# Configuration pour les outils en ligne de commande
app opensc-tool {
    debug = 3;
}

app pkcs15-tool {
    debug = 3;
}

app pkcs15-init {
    debug = 3;
}

app pkcs11-tool {
    debug = 3;
}
